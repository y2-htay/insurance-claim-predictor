{% extends "base_generic.html" %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/invoice.css' %}">

{% block content %}
<h1>Invoice for Claim #{{ claim.id }}</h1>

<div class="edit-container">
    {% if error %}
        <p style="color: red;">{{ error }}</p>
    {% else %}
    <p><strong>Predicted Settlement Amount:</strong> ${{ predicted_value }}</p>

    <h3>Claim Details:</h3>
    <ul>
        <li>Injury Description: {{ claim.injury_description }}</li>
        <li>Vehicle Type: {{ claim.vehicle_type }}</li>
        <li>Weather Condition: {{ claim.weather_condition }}</li>
        <li>Driver Age: {{ claim.driver_age }}</li>
        <li>Vehicle Age: {{ claim.vehicle_age }}</li>
        <li>Passengers Involved: {{ claim.passengers_involved }}</li>
        <li>Psychological Injury: {{ claim.psychological_injury }}</li>
        <li>Whiplash: {{ claim.whiplash }}</li>
        <li>Injury Prognosis (Months): {{ claim.injury_prognosis_months }}</li>
        <li>Exceptional Circumstance: {{ claim.exceptional_circumstance }}</li>
        <li>Police Report Filed: {{ claim.police_report }}</li>
        <li>Witness Present: {{ claim.witness_present }}</li>
        <li>Gender: {{ claim.gender }}</li>
    </ul>

    <button id="checkout-button">Pay Now</button>
    <a href="{% url 'profile' %}"><button id="decide-later-button">Decide Later</button></a>

</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripe = Stripe("{{ stripe_publishable_key }}");

    document.getElementById("checkout-button").addEventListener("click", function () {
        fetch("{% url 'create_checkout_session' claim.id %}", {
            method: "POST",
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
            },
        })
        .then(response => response.json())
        .then(session => {
            return stripe.redirectToCheckout({ sessionId: session.id });
        })
        .then(result => {
            if (result.error) {
                alert(result.error.message);
            }
        })
        .catch(error => {
            console.error("Error:", error);
        });
    });
</script>

{% endif %}
{% endblock %}