{% extends "base_generic.html" %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/edit_claim.css' %}">

{% block content %}
<div class="back-wrapper">
  <a href="{% url 'profile' %}" class="btn-back">‚Üê Back</a>
</div>
<div class="edit-container">
  <h2>Edit Claim</h2>

  {% if error %}
    <p class="error">{{ error }}</p>
  {% endif %}

  <form method="POST" enctype="multipart/form-data" id="editClaimForm">
    {% csrf_token %}

    <div class="form-group">
      <label for="passengers">Passengers Involved:</label>
      <input type="number" id="passengers" name="passengers_involved" value="{{ claim.passengers_involved }}" required>
    </div>

    <div class="form-group checkbox-group">
      <label>
        <input type="checkbox" name="psychological_injury" {% if claim.psychological_injury %}checked{% endif %}>
        Psychological Injury
      </label>
    </div>

    <div class="form-group">
      <label for="prognosis">Injury Prognosis (Months):</label>
      <input type="number" id="prognosis" name="injury_prognosis_months" value="{{ claim.injury_prognosis_months }}">
    </div>

    <div class="form-group checkbox-group">
      <label>
        <input type="checkbox" name="exceptional_circumstance" {% if claim.exceptional_circumstance %}checked{% endif %}>
        Exceptional Circumstance
      </label>
    </div>

    <div class="form-group">
      <label for="injury">Dominant Injury:</label>
      <input type="text" id="injury" name="dominant_injury" value="{{ claim.dominant_injury }}">
    </div>

    <div class="form-group checkbox-group">
      <label>
        <input type="checkbox" name="whiplash" {% if claim.whiplash %}checked{% endif %}>
        Whiplash
      </label>
    </div>

    <div class="form-group">
      <label for="vehicle_type">Vehicle Type:</label>
      <select name="vehicle_type" id="vehicle_type" required>
        {% for vt in vehicle_types %}
          <option value="{{ vt.id }}" {% if claim.vehicle_type == vt.id %}selected{% endif %}>
            {{ vt.vehicle_name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="form-group">
      <label for="weather_condition">Weather Condition:</label>
      <select name="weather_condition" id="weather_condition" required>
        {% for wc in weather_conditions %}
          <option value="{{ wc.id }}" {% if claim.weather_condition == wc.id %}selected{% endif %}>
            {{ wc.condition }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="form-group">
      <label for="driver_age">Driver Age:</label>
      <input type="number" id="driver_age" name="driver_age" value="{{ claim.driver_age }}">
    </div>

    <div class="form-group">
      <label for="vehicle_age">Vehicle Age:</label>
      <input type="number" id="vehicle_age" name="vehicle_age" value="{{ claim.vehicle_age }}">
    </div>

    <div class="form-group checkbox-group">
      <label>
        <input type="checkbox" name="police_report" {% if claim.police_report %}checked{% endif %}>
        Police Report
      </label>
    </div>

    <div class="form-group checkbox-group">
      <label>
        <input type="checkbox" name="witness_present" {% if claim.witness_present %}checked{% endif %}>
        Witness Present
      </label>
    </div>

    <div class="form-group">
      <label for="gender">Gender:</label>
      <select name="gender" id="gender">
        <option value="male" {% if claim.gender == "male" %}selected{% endif %}>Male</option>
        <option value="female" {% if claim.gender == "female" %}selected{% endif %}>Female</option>
        <option value="other" {% if claim.gender == "other" %}selected{% endif %}>Other</option>
      </select>
    </div>

    <div class="form-group">
      <label for="supporting_documents">Supporting Documents (optional):</label>
      <input type="file" name="supporting_documents" id="supporting_documents">
      <small id="fileName" class="file-name"></small>
    </div>

    <div class="form-group checkbox-group consent">
      <label>
        <input type="checkbox" id="consentCheckbox" name="consent" required>
        I give my explicit consent to the processing of my personal and health-related data in accordance with the
        <a href="{% url 'privacy_policy' %}" target="_blank">Privacy Policy</a>.
      </label>
    </div>

    <button type="submit" class="btn btn-primary">Update Claim</button>
  </form>

  <hr>

  <form method="POST" onsubmit="return confirm('Are you sure you want to delete this claim?');">
    {% csrf_token %}
    <input type="hidden" name="delete" value="true">
    <button type="submit" class="btn btn-danger">Delete Claim</button>
  </form>
</div>

<script>
  document.getElementById("supporting_documents").addEventListener("change", function () {
    const fileLabel = document.getElementById("fileName");
    fileLabel.innerText = this.files.length ? `Selected file: ${this.files[0].name}` : "";
  });

  document.getElementById("editClaimForm").addEventListener("submit", function (e) {
    if (!document.getElementById("consentCheckbox").checked) {
      alert("You must provide explicit consent to submit this form.");
      e.preventDefault();
    }
  });
</script>
{% endblock %}
